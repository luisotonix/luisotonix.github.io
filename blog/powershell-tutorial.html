<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerShell para Administradores: Do B√°sico ao Avan√ßado - Lu√≠s Otoni</title>
    <meta name="description" content="Tutorial completo de PowerShell focado em administra√ß√£o de sistemas Microsoft. Scripts pr√°ticos, exemplos reais e melhores pr√°ticas.">
    <meta name="keywords" content="PowerShell, Scripting, Windows Administration, Azure PowerShell, Microsoft 365 PowerShell, Automation">
    <meta name="author" content="Lu√≠s Otoni">
    <link rel="canonical" href="https://luisotonix.github.io/blog/powershell-tutorial.html">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">Lu√≠s Otoni</div>
            <div class="nav-menu" id="nav-menu">
                <ul class="nav-links">
                    <li><a href="../index.html" data-i18n="nav_home">In√≠cio</a></li>
                    <li><a href="../about.html" data-i18n="nav_about">Sobre</a></li>
                    <li><a href="../portfolio.html" data-i18n="nav_portfolio">Portf√≥lio</a></li>
                    <li><a href="../services.html" data-i18n="nav_services">Servi√ßos</a></li>
                    <li><a href="../blog.html" class="active" data-i18n="nav_blog">Blog</a></li>
                    <li><a href="../contact.html" data-i18n="nav_contact">Contato</a></li>
                </ul>
                <div class="nav-controls">
                    <button id="theme-toggle" aria-label="Toggle theme"><span id="theme-icon">üåô</span></button>
                    <select id="language-selector" aria-label="Select language">
                        <option value="pt">üáßüá∑ PT</option>
                        <option value="en">üá∫üá∏ EN</option>
                        <option value="es">üá™üá∏ ES</option>
                    </select>
                </div>
            </div>
            <button id="mobile-menu-btn" aria-label="Toggle mobile menu">
                <span></span><span></span><span></span>
            </button>
        </nav>
    </header>

    <main>
        <!-- Article Header -->
        <section class="article-header">
            <div class="container-narrow">
                <div class="portfolio-tags mb-3" style="justify-content: center;">
                    <span class="tag primary">PowerShell</span>
                    <span class="tag">Scripting</span>
                    <span class="tag">Tutorial</span>
                </div>
                <h1 class="article-title">PowerShell para Administradores: Do B√°sico ao Avan√ßado</h1>
                <div class="article-meta">
                    <span>üë§ Lu√≠s Otoni</span>
                    <span>üìÖ 01 de Novembro de 2025</span>
                    <span>‚è±Ô∏è 20 min de leitura</span>
                    <span>üìÅ Tutorial</span>
                </div>
            </div>
        </section>

        <!-- Article Content -->
        <article class="article-content">
            <p>
                PowerShell √© a ferramenta mais poderosa no arsenal de um administrador Microsoft. 
                Desde automa√ß√£o de tarefas simples at√© gerenciamento complexo de Azure e Microsoft 365, 
                dominar PowerShell multiplica sua produtividade. Neste tutorial completo, vou gui√°-lo 
                do b√°sico ao avan√ßado com exemplos pr√°ticos.
            </p>

            <h2>1. Fundamentos do PowerShell</h2>

            <h3>O Que √© PowerShell?</h3>
            <p>
                PowerShell √© uma linguagem de scripting e shell de linha de comando desenvolvida pela 
                Microsoft. Diferente de shells tradicionais que trabalham com texto, PowerShell trabalha 
                com <strong>objetos</strong>, o que a torna muito mais poderosa.
            </p>

            <h3>Vers√µes do PowerShell</h3>
            <ul>
                <li><strong>Windows PowerShell 5.1:</strong> Inclu√≠do no Windows, usa .NET Framework</li>
                <li><strong>PowerShell 7+:</strong> Cross-platform (Windows, Linux, macOS), usa .NET Core</li>
            </ul>
            <p>
                <strong>Recomenda√ß√£o:</strong> Use PowerShell 7 para novos scripts. Instale via 
                <code>winget install Microsoft.PowerShell</code>
            </p>

            <h3>Primeiros Comandos</h3>
            <p>
                PowerShell usa o padr√£o <strong>Verb-Noun</strong> para comandos (chamados cmdlets):
            </p>
            <pre><code># Listar processos
Get-Process

# Listar servi√ßos
Get-Service

# Obter ajuda sobre um comando
Get-Help Get-Process -Full

# Descobrir comandos dispon√≠veis
Get-Command -Verb Get -Noun *Service*</code></pre>

            <h3>Pipeline - O Poder do PowerShell</h3>
            <p>
                O pipeline (<code>|</code>) passa objetos de um comando para outro:
            </p>
            <pre><code># Listar processos consumindo mais de 100MB de mem√≥ria
Get-Process | Where-Object {$_.WorkingSet64 -gt 100MB}

# Parar servi√ßos que come√ßam com "Print"
Get-Service -Name Print* | Stop-Service

# Exportar usu√°rios do AD para CSV
Get-ADUser -Filter * | Select-Object Name, Email | Export-Csv users.csv</code></pre>

            <h2>2. Vari√°veis e Tipos de Dados</h2>

            <h3>Declarando Vari√°veis</h3>
            <pre><code># Vari√°veis simples
$nome = "Lu√≠s Otoni"
$idade = 35
$ativo = $true

# Arrays
$servidores = @("Server01", "Server02", "Server03")

# Hashtables (dicion√°rios)
$usuario = @{
    Nome = "Jo√£o Silva"
    Email = "joao@empresa.com"
    Departamento = "TI"
}

# Acessando valores
$usuario.Nome
$servidores[0]</code></pre>

            <h3>Tipos Especiais</h3>
            <pre><code># Strings multilinha (here-string)
$script = @"
Este √© um texto
com m√∫ltiplas linhas
e preserva a formata√ß√£o
"@

# Datas
$hoje = Get-Date
$amanha = $hoje.AddDays(1)
$formatado = $hoje.ToString("dd/MM/yyyy")</code></pre>

            <h2>3. Estruturas de Controle</h2>

            <h3>Condicionais</h3>
            <pre><code># If/ElseIf/Else
$disco = Get-Volume -DriveLetter C
if ($disco.SizeRemaining -lt 10GB) {
    Write-Warning "Disco C com pouco espa√ßo!"
} elseif ($disco.SizeRemaining -lt 50GB) {
    Write-Host "Disco C precisa de aten√ß√£o"
} else {
    Write-Host "Disco C OK"
}

# Switch
$diaSemana = (Get-Date).DayOfWeek
switch ($diaSemana) {
    "Monday"    { Write-Host "In√≠cio da semana!" }
    "Friday"    { Write-Host "Sextou!" }
    default     { Write-Host "Dia normal" }
}</code></pre>

            <h3>Loops</h3>
            <pre><code># ForEach
$servidores = @("Server01", "Server02", "Server03")
foreach ($servidor in $servidores) {
    Test-Connection -ComputerName $servidor -Count 1
}

# ForEach-Object (no pipeline)
Get-Service | ForEach-Object {
    Write-Host "Servi√ßo: $($_.Name) - Status: $($_.Status)"
}

# For
for ($i = 1; $i -le 10; $i++) {
    Write-Host "Itera√ß√£o $i"
}

# While
$contador = 0
while ($contador -lt 5) {
    Write-Host "Contador: $contador"
    $contador++
}</code></pre>

            <h2>4. Fun√ß√µes e Scripts</h2>

            <h3>Criando Fun√ß√µes</h3>
            <pre><code># Fun√ß√£o b√°sica
function Get-DiskSpace {
    Get-Volume | Select-Object DriveLetter, 
        @{N='SizeGB';E={[math]::Round($_.Size/1GB,2)}},
        @{N='FreeGB';E={[math]::Round($_.SizeRemaining/1GB,2)}}
}

# Fun√ß√£o com par√¢metros
function Test-ServerConnection {
    param(
        [Parameter(Mandatory=$true)]
        [string]$ServerName,
        
        [int]$Port = 3389,
        
        [int]$Timeout = 3000
    )
    
    $tcpClient = New-Object System.Net.Sockets.TcpClient
    try {
        $result = $tcpClient.BeginConnect($ServerName, $Port, $null, $null)
        $wait = $result.AsyncWaitHandle.WaitOne($Timeout, $false)
        
        if ($wait) {
            $tcpClient.EndConnect($result)
            return $true
        } else {
            return $false
        }
    } catch {
        return $false
    } finally {
        $tcpClient.Close()
    }
}

# Usando a fun√ß√£o
Test-ServerConnection -ServerName "server01.empresa.com" -Port 443</code></pre>

            <h3>Scripts com Par√¢metros</h3>
            <pre><code># No in√≠cio do arquivo .ps1
param(
    [Parameter(Mandatory=$true)]
    [string]$InputFile,
    
    [string]$OutputFolder = "C:\Output",
    
    [switch]$Verbose
)

# Valida√ß√£o de par√¢metros avan√ßada
param(
    [Parameter(Mandatory=$true)]
    [ValidateScript({Test-Path $_})]
    [string]$FilePath,
    
    [ValidateSet("CSV", "JSON", "XML")]
    [string]$Format = "CSV",
    
    [ValidateRange(1, 100)]
    [int]$MaxItems = 50
)</code></pre>

            <h2>5. Tratamento de Erros</h2>

            <h3>Try/Catch/Finally</h3>
            <pre><code>try {
    # C√≥digo que pode falhar
    $content = Get-Content -Path "C:\arquivo.txt" -ErrorAction Stop
    Write-Host "Arquivo lido com sucesso"
} catch [System.IO.FileNotFoundException] {
    Write-Warning "Arquivo n√£o encontrado!"
} catch {
    Write-Error "Erro inesperado: $($_.Exception.Message)"
} finally {
    # Sempre executa, mesmo com erro
    Write-Host "Opera√ß√£o finalizada"
}</code></pre>

            <h3>ErrorAction e ErrorVariable</h3>
            <pre><code># Continuar mesmo com erros
Get-ChildItem -Path "C:\Pasta" -ErrorAction SilentlyContinue

# Capturar erros em vari√°vel
Get-Service -Name "ServicoInexistente" -ErrorAction SilentlyContinue -ErrorVariable erros
if ($erros) {
    Write-Warning "Houve erros: $erros"
}</code></pre>

            <h2>6. Trabalhando com Active Directory</h2>

            <h3>M√≥dulo AD</h3>
            <pre><code># Importar m√≥dulo (necess√°rio RSAT instalado)
Import-Module ActiveDirectory

# Buscar usu√°rios
Get-ADUser -Filter {Enabled -eq $true} -Properties Email, Department |
    Select-Object Name, SamAccountName, Email, Department

# Criar novo usu√°rio
New-ADUser -Name "Maria Santos" `
    -SamAccountName "msantos" `
    -UserPrincipalName "msantos@empresa.com" `
    -GivenName "Maria" `
    -Surname "Santos" `
    -Department "RH" `
    -Enabled $true `
    -AccountPassword (ConvertTo-SecureString "SenhaTemp123!" -AsPlainText -Force)

# Adicionar usu√°rio a grupo
Add-ADGroupMember -Identity "GrupoTI" -Members "msantos"

# Buscar computadores inativos (90+ dias)
$dataLimite = (Get-Date).AddDays(-90)
Get-ADComputer -Filter {LastLogonDate -lt $dataLimite} -Properties LastLogonDate |
    Select-Object Name, LastLogonDate</code></pre>

            <h2>7. PowerShell para Azure</h2>

            <h3>Conectando ao Azure</h3>
            <pre><code># Instalar m√≥dulo Azure
Install-Module -Name Az -Scope CurrentUser

# Conectar (abre browser para autentica√ß√£o)
Connect-AzAccount

# Listar subscriptions
Get-AzSubscription

# Selecionar subscription
Set-AzContext -SubscriptionId "xxxx-xxxx-xxxx"</code></pre>

            <h3>Gerenciando Recursos Azure</h3>
            <pre><code># Listar VMs
Get-AzVM | Select-Object Name, ResourceGroupName, Location

# Iniciar/Parar VMs
Start-AzVM -ResourceGroupName "RG-Producao" -Name "VM-WebServer01"
Stop-AzVM -ResourceGroupName "RG-Producao" -Name "VM-WebServer01" -Force

# Criar Resource Group
New-AzResourceGroup -Name "RG-Teste" -Location "brazilsouth"

# Obter m√©tricas de VM
Get-AzMetric -ResourceId "/subscriptions/.../Microsoft.Compute/virtualMachines/VM01" `
    -MetricName "Percentage CPU" -TimeGrain 00:05:00</code></pre>

            <h2>8. PowerShell para Microsoft 365</h2>

            <h3>Conectando aos Servi√ßos</h3>
            <pre><code># Instalar m√≥dulos necess√°rios
Install-Module Microsoft.Graph -Scope CurrentUser
Install-Module ExchangeOnlineManagement -Scope CurrentUser

# Conectar ao Microsoft Graph
Connect-MgGraph -Scopes "User.Read.All", "Group.ReadWrite.All"

# Conectar ao Exchange Online
Connect-ExchangeOnline -UserPrincipalName admin@empresa.com</code></pre>

            <h3>Gerenciando Usu√°rios M365</h3>
            <pre><code># Listar todos os usu√°rios
Get-MgUser -All | Select-Object DisplayName, UserPrincipalName, AccountEnabled

# Criar novo usu√°rio
$passwordProfile = @{
    Password = "SenhaTemp123!"
    ForceChangePasswordNextSignIn = $true
}

New-MgUser -DisplayName "Jo√£o Silva" `
    -UserPrincipalName "jsilva@empresa.onmicrosoft.com" `
    -MailNickname "jsilva" `
    -AccountEnabled `
    -PasswordProfile $passwordProfile

# Atribuir licen√ßa
$userId = (Get-MgUser -UserId "jsilva@empresa.onmicrosoft.com").Id
$skuId = (Get-MgSubscribedSku | Where-Object SkuPartNumber -eq "ENTERPRISEPACK").SkuId

Set-MgUserLicense -UserId $userId -AddLicenses @{SkuId = $skuId} -RemoveLicenses @()</code></pre>

            <h3>Gerenciando Exchange Online</h3>
            <pre><code># Listar mailboxes
Get-EXOMailbox | Select-Object DisplayName, PrimarySmtpAddress, RecipientTypeDetails

# Criar shared mailbox
New-Mailbox -Shared -Name "Suporte TI" -PrimarySmtpAddress "suporte@empresa.com"

# Dar permiss√£o Full Access
Add-MailboxPermission -Identity "suporte@empresa.com" `
    -User "jsilva@empresa.com" -AccessRights FullAccess

# Relat√≥rio de mailbox sizes
Get-EXOMailbox -ResultSize Unlimited | 
    Get-EXOMailboxStatistics | 
    Select-Object DisplayName, TotalItemSize, ItemCount |
    Sort-Object TotalItemSize -Descending |
    Export-Csv "MailboxSizes.csv"</code></pre>

            <h2>9. Scripts Pr√°ticos do Dia a Dia</h2>

            <h3>Relat√≥rio de Espa√ßo em Disco</h3>
            <pre><code>function Get-DiskReport {
    param(
        [string[]]$ComputerName = $env:COMPUTERNAME
    )
    
    foreach ($computer in $ComputerName) {
        try {
            Get-CimInstance -ClassName Win32_LogicalDisk -ComputerName $computer |
                Where-Object DriveType -eq 3 |
                Select-Object @{N='Computer';E={$computer}},
                    DeviceID,
                    @{N='SizeGB';E={[math]::Round($_.Size/1GB,2)}},
                    @{N='FreeGB';E={[math]::Round($_.FreeSpace/1GB,2)}},
                    @{N='PercentFree';E={[math]::Round(($_.FreeSpace/$_.Size)*100,1)}}
        } catch {
            Write-Warning "N√£o foi poss√≠vel conectar a $computer"
        }
    }
}

# Uso
Get-DiskReport -ComputerName "Server01", "Server02" | 
    Where-Object PercentFree -lt 20 |
    Format-Table</code></pre>

            <h3>Backup de Group Policy Objects</h3>
            <pre><code>function Backup-AllGPOs {
    param(
        [string]$BackupPath = "C:\GPOBackups"
    )
    
    $date = Get-Date -Format "yyyy-MM-dd"
    $backupFolder = Join-Path $BackupPath $date
    
    if (-not (Test-Path $backupFolder)) {
        New-Item -ItemType Directory -Path $backupFolder | Out-Null
    }
    
    Get-GPO -All | ForEach-Object {
        $gpoName = $_.DisplayName -replace '[\\/:*?"<>|]', '_'
        Backup-GPO -Guid $_.Id -Path $backupFolder -Comment "Backup $date"
        Write-Host "Backup conclu√≠do: $($_.DisplayName)"
    }
    
    Write-Host "`nBackups salvos em: $backupFolder"
}

Backup-AllGPOs</code></pre>

            <h3>Monitoramento de Servi√ßos Cr√≠ticos</h3>
            <pre><code>$servicosCriticos = @(
    "W3SVC",      # IIS
    "MSSQLSERVER", # SQL Server
    "Spooler"      # Print Spooler
)

$resultado = foreach ($servico in $servicosCriticos) {
    $svc = Get-Service -Name $servico -ErrorAction SilentlyContinue
    
    [PSCustomObject]@{
        Servico = $servico
        Status = if ($svc) { $svc.Status } else { "N√£o encontrado" }
        StartType = if ($svc) { $svc.StartType } else { "N/A" }
    }
}

$servicosParados = $resultado | Where-Object Status -ne "Running"

if ($servicosParados) {
    Write-Warning "Servi√ßos com problemas detectados:"
    $servicosParados | Format-Table
    
    # Enviar email de alerta
    # Send-MailMessage ...
}</code></pre>

            <h2>10. Melhores Pr√°ticas</h2>

            <h3>Estilo de C√≥digo</h3>
            <ul>
                <li>Use nomes descritivos para vari√°veis e fun√ß√µes</li>
                <li>Comente c√≥digo complexo</li>
                <li>Use <code>-WhatIf</code> para testar antes de executar mudan√ßas</li>
                <li>Prefira cmdlets nativos a comandos externos</li>
                <li>Use <code>-ErrorAction Stop</code> com try/catch</li>
            </ul>

            <h3>Seguran√ßa</h3>
            <ul>
                <li>Nunca hardcode senhas em scripts</li>
                <li>Use <code>Get-Credential</code> ou Azure Key Vault</li>
                <li>Assine scripts com certificado de c√≥digo</li>
                <li>Configure Execution Policy adequadamente</li>
            </ul>

            <h3>Performance</h3>
            <ul>
                <li>Use <code>-Filter</code> ao inv√©s de <code>Where-Object</code> quando poss√≠vel</li>
                <li>Evite loops quando pipeline resolve</li>
                <li>Use <code>[System.Collections.ArrayList]</code> para grandes cole√ß√µes</li>
                <li>Considere jobs paralelos para tarefas independentes</li>
            </ul>

            <h2>Recursos para Continuar Aprendendo</h2>
            <ul>
                <li><strong>Microsoft Learn:</strong> Cursos gratuitos de PowerShell</li>
                <li><strong>PowerShell Gallery:</strong> M√≥dulos e scripts da comunidade</li>
                <li><strong>GitHub:</strong> Reposit√≥rios com scripts de exemplo</li>
                <li><strong>Get-Help:</strong> Documenta√ß√£o integrada (use <code>Update-Help</code>)</li>
            </ul>

            <h2>Conclus√£o</h2>
            <p>
                PowerShell √© uma habilidade essencial para qualquer administrador Microsoft. 
                Este tutorial cobriu os fundamentos, mas PowerShell √© vasto - continue praticando, 
                automatizando tarefas do dia a dia, e explorando novos m√≥dulos.
            </p>
            <p>
                <strong>Dica final:</strong> Comece automatizando uma tarefa que voc√™ faz 
                manualmente toda semana. O tempo investido em aprender retornar√° multiplicado 
                em produtividade.
            </p>
        </article>

        <!-- Share Buttons -->
        <section>
            <div class="container-narrow">
                <h3 style="text-align: center; margin-bottom: 1.5rem; color: var(--text-primary);">
                    Compartilhe este artigo
                </h3>
                <div class="share-buttons">
                    <button class="share-btn" data-platform="twitter">üê¶ Twitter</button>
                    <button class="share-btn" data-platform="linkedin">üíº LinkedIn</button>
                    <button class="share-btn" data-platform="facebook">üëç Facebook</button>
                </div>
            </div>
        </section>

        <!-- Back to Blog -->
        <section>
            <div class="container text-center">
                <a href="../blog.html" class="btn btn-outline" data-i18n="back_blog">‚Üê Voltar ao Blog</a>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 Lu√≠s Otoni. <span data-i18n="footer_rights">Todos os direitos reservados</span>.</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>
